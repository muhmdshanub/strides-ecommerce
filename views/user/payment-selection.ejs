


<%- include('../layouts/user-header') -%>

<%- include('../layouts/user-navbar') -%>

<%- include('../layouts/_messages') -%>


  <style>
  /* Custom styles */
  .address-container {
    height: 400px; /* Fixed height for the container */
    overflow-y: auto; /* Enable vertical scrolling */
  }

  /* Custom sticky class */
  .sticky-col {
    position: -webkit-sticky;
    position: sticky;
    top: 0;
    z-index: 2100;
  }
</style>


<div class="container-fluid mb-5 pb-5 text-black" style="background-color: rgba(186, 251, 251, 0.799);">
  <div class="row mt-4 mb-5">
    <!-- Left Part (7/12) -->
    <div class="col-md-7 mb-5">

      
      <h3 class="py-2 mt-3">Select Address</h3>
      <div class="address-container mt-1 mb-5 border rounded text-black p-3  " style="background-color: rgb(228, 251, 251);">
       

        
        <!-- Dynamic Addresses (Use EJS to iterate through addresses) -->
        <% user.addresses.forEach((address, index)=> { %>
          <div class="card mb-2" onclick="selectAddress('<%= address._id %>')">
            <div class="card-body">
              <div class="form-check">
                <input type="radio" class="form-check-input" name="addressRadio" id="address_<%= address._id %>" <%= address.id.toString() === firstAddress._id.toString() ? 'checked' : '' %>>
                <label class="form-check-label" for="address_<%= index %>">
                  <!-- Display address fields here -->
                  <strong>
                    <%= address.name %>
                  </strong><br>
                  <%= address.street %>, <%= address.city %>, <%= address.state %>
                  <%= address.zipCode %><br><br>
                  Phone Number: <%= address.phoneNumber %>
                </label>
              </div>
              <!-- Include hidden input for _id -->
              <input type="hidden" name="addressId" value="<%= address._id %>">
              
            </div>
          </div>
          <% })  %>
          <% if(user.addresses.length === 0){ %>
            <h6 class="p-5 m-5">You didn't add any address yet. Please add a valid address now.</h6>

          <%}%>

      </div>

      <div class="payment-container-fluid border rounded py-5 px-2 my-5 " style="background-color: rgb(239, 249, 249);">

        <h3 class="px-3 mb-5">Select the Payment method</h3>

        <div class="row mt-2">
          
          <!-- Left Section (4/12 width) -->
          <div class="col-md-4 border p-0 offset-1">
            <!-- Content for the left section goes here -->
            <div class="col-12 py-2 border rounded" style="background-color: rgb(251, 213, 190);">
              <button class="btn btn-danger btn-block my-3" id="cashOnDeliveryBtn">Cash on Delivery</button>
            </div>
            <div class="col-12 py-2 border rounded" style="background-color:rgb(251, 213, 190) ;" >
              <button class="btn btn-pink btn-block my-3" id="payNowBtn">Pay Now</button>
            </div>
            
            
          </div>
      
          <!-- Right Section (8/12 width) -->
          <div class="col-md-6 border payment-show text-center justify-content-center">
            <!-- Content for the right section goes here -->
            <!-- Initially, this section can be empty -->
            <!-- Place Order Now button can be dynamically added later using JavaScript -->
          </div>
        </div>
      </div>


    </div>

    <!-- Right Part (5/12) -->
    <div class="col-md-5 sticky-col">
      <div class="container-fluid mt-4 border rounded p-5 bg-white">
        <div class="row">
            <div class="col-md-10 offset-md-1">
                <div class="total-amount-section">
                    <h2>Total Amount</h2>
    
                    <!-- MRP Section -->
                    <div class="amount-row d-flex justify-content-between mt-5 mb-1" style="font-size: larger;">
                        <span>Total MRP</span>
                        <span id="totalMRP"><%= cart.totalInitialAmount  %>Rs.</span>
                    </div>
    
                    <!-- Discount Section -->
                    <div class="amount-row d-flex justify-content-between my-1" style="font-size: larger;">
                        <span>Discount</span>
                        <span id="discount"><%= cart.totalDiscountAmount  %>Rs.</span>
                    </div>
                    <hr>
                    <!-- Amount To Pay Section -->
                    <div class="amount-row d-flex justify-content-between mt-3 mb-5" style="font-size: larger; font-weight: 500;">
                        <span>Amount To Pay</span>
                        <span id="amountToPay"><%= cart.totalAmount  %>Rs.</span>
                      </div></span>
                    </div>
    
                    
                    
                    
                </div>
            </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>










<script>
  // Assuming this is triggered when the "Cash on Delivery" button is clicked
  document.getElementById('cashOnDeliveryBtn').addEventListener('click', function() {
    // Check if the "Place Order Now" button already exists
    if (!document.getElementById('placeOrderBtn')) {
      // Dynamically add the text above the "Place Order Now" button
      const infoText = document.createElement('p');
      infoText.className = 'p-2 mt-3 ';
      infoText.style = 'background-color:rgb(230, 246, 228)'
      infoText.textContent = "If you are proceeding with the Cash on Delivery method, please click on the below link to place the order:";
      document.querySelector('.payment-show').appendChild(infoText);

      // Dynamically add the "Place Order Now" button to the right section
      const placeOrderButton = document.createElement('button');
      placeOrderButton.id = 'placeOrderBtn';
      placeOrderButton.className = 'btn btn-primary p-2 my-2'; // Adjusted the margin to my-2
      placeOrderButton.textContent = 'Place Order Now';

      // Add an event listener or any other logic for the "Place Order Now" button if needed
       // Event listener for the "Continue To Payment" button
   placeOrderButton.addEventListener('click', function() {

    
// Find the selected address radio button
const selectedAddressRadioButton = document.querySelector('input[name="addressRadio"]:checked');

// Check if any address is selected
if (!selectedAddressRadioButton) {
  alert('Please select an address before placing the order.');
  return;
}

// Extract the addressId from the selected radio button
const addressId = selectedAddressRadioButton.id.split('_')[1];
console.log("addressID is " + addressId)
// Update the window location directly without making a fetch request
//window.location.href = `/address-to-payment/${addressId}`;

});

      // Append the button to the right section
      document.querySelector('.payment-show').appendChild(placeOrderButton);
    }
  });

  function selectAddress(index) {
    // Get the radio button corresponding to the clicked card
    const radioButton = document.getElementById(`address_${index}`);

    // Check the radio button
    radioButton.checked = true;
  }


  
</script>



<%- include('../layouts/user-footer') -%>



